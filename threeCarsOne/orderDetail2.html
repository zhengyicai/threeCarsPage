<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>订单详情</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="./css/mui.min.css">
		<link href="./css/mui.picker.css" rel="stylesheet" />
		<link href="./css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/header.css" />
		<style>
			h5 {
				margin: 5px 7px;
			}
			.savebuttom{
				display: flex;
				justify-content: space-between;
				text-align: center;
			}
				.savebuttom a{
				width: 50%;
				height: 50px;
				background: #F78A5C;
				color: #fff;
				line-height: 50px;
				position: relative;
				bottom: 0;
			}
			.savebuttom :last-child{
				background: #59BA2D;
			}
			
			.mui-input-group .mui-input-row:after{
				height: 0px;
			}
			
			.mui-input-group .mui-input-row {
			    height: 35px;
				color:#000000;
				font-size: 15px;
			}
			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">订单详情</h1>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded">
				<!-- <button id='showCityPicker3' class="mui-btn mui-btn-block" type='button' ><span id='cityResult3'> 三级联动示例 ...</span></button> -->
				<!--<div id='cityResult3' class="ui-alert"></div>-->
			</div>
			<div class="mui-content-padded" style="margin: 0px;">
				<form class="mui-input-group">
					<div class="mui-input-row" style="color: #000000;">
						<label>订单编号：</label>
						<div style="line-height:45px;height: 45px;">
							<span id="orderId"></span>
							<span id="orderType"></span>
							
						</div>
						
					</div>
					
					<div class="mui-input-row">
						<label>预约时间：</label>
						<input type="text" class="mui-input-clear" placeholder="" id="lastTime">
					</div>
					
					<div class="mui-input-row">
						<label>区域：</label>
						<input type="text" class="mui-input-clear" placeholder="" id="cityResult3" >
					</div>
					<div class="mui-input-row">
						<label>详细地址：</label>
						<input type="text" class="mui-input-clear" placeholder="" id="addressDetail" >
					</div>
					
					<div class="mui-input-row">
						<label>联系人：</label>
						<input type="text" class="mui-input-clear" placeholder="" id="contactMobile">
					</div>
					
					<div class="mui-input-row showType1" style="display: none;">
						<label>总价：</label>
						<input type="text" class="mui-input-clear" placeholder="" id="buyPrice">
					</div>
					<div class="mui-input-row  showType">
						<label>预估最小重量：</label>
						<div style="height: 40px;line-height: 40px;">
						<span style="font-size: 18px;line-height: 20px; color: red;" id="weightbottom"></span>斤
						</div>
					</div>
					<div class="mui-input-row showType">
						<label>预估最大重量：</label>
						<div style="height: 40px;line-height: 40px;">
						<span style="font-size: 18px;line-height: 20px; color: red;" id="weighttop"></span>斤
						</div>
					</div>
				<div class="savebuttom mui-bar-footer mui-bar mui-bar-tab showType" style="-webkit-box-shadow:0 0 0px rgba(0,0,0,.85); box-shadow:0 0 0px rgba(0,0,0,.85);">
						<a  style="background-color: white; color: #000000;font-size: 14px;">预计总价格：<span style="font-size: 18px;background-color: white; color: red;" id="autoPrice">￥</span></a>
						<a  id="cannelOrder"  style="background-color: #f0ad4e; ">恢复订单</a>
						<a  id="hidderOrder"  style="background-color: white; display: none; "></a>
						
				</div>
				
				<!-- <a href="#picture" class="mui-btn mui-btn-primary mui-btn-block mui-btn-outlined" style="padding: 5px 20px;">打开actionsheet</a> -->
				<div id="picture" class="mui-popover mui-popover-action mui-popover-bottom">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell">
							<a href="#">其它</a>
						</li>
						<li class="mui-table-view-cell">
							<a href="#">不小心点错了</a>
						</li>
						<li class="mui-table-view-cell">
							<a href="#">价格太低</a>
						</li>
						<li class="mui-table-view-cell">
							<a href="#">态度太差</a>
						</li>
						<li class="mui-table-view-cell">
							<a href="#">太久没上门</a>
						</li>
					</ul>
					<ul class="mui-table-view" >
						<li class="mui-table-view-cell">
							<a href="#picture"><b>取消</b></a>
						</li>
					</ul>
				</div>
				<!-- <p id="info"></p> -->

					<!--<div class="mui-button-row">
						<button type="button" class="mui-btn mui-btn-primary" onclick="return false;">确认</button>&nbsp;&nbsp;
						<button type="button" class="mui-btn mui-btn-danger" onclick="return false;">取消</button>
					</div>-->
				</form>
			</div>
		</div>
		<script src="./js/mui.min.js"></script>
		<script src="./js/mui.picker.js"></script>
		<script src="./js/mui.poppicker.js"></script>
		
		<script src="./js/city.data.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/city.data-3.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/path.js"></script>
		<script src="./js/jquery-v1.10.3.min.js"></script>
		<script>
			var wxIds = $wxId; 
			var ids = "";
			var persons = "";
			
			if(getQueryVariable("openId") ==null || getQueryVariable("openId") =="null" || getQueryVariable("openId") ==false ){
				$wxId = localStorage.getItem("wxId");
				wxIds = localStorage.getItem("wxId");
			}else{
				$wxId = getQueryVariable("openId");
				wxIds =  getQueryVariable("openId");
				localStorage.setItem("wxId",getQueryVariable("openId"));
				localStorage.setItem("nickname",getQueryVariable("nickname"));
				localStorage.setItem("imageurl",getQueryVariable("headimgurl"));
			}
			
			$(".mui-input-clear").attr("disabled","disabled");
			
			$("#save").click(function(){
				
				
				
			})
			
			
			$(function(){
				
				ids = getUrlParms("ids");
				if(ids !=null){
					
					$("#orderId").html(ids);
					
					
					$("#cannelOrder").click(function(){
						var person ={
							id:ids,
							type:"20",
							carId:wxIds,
							remark:""
						}
						mui.ajax($server_path+"/homeApp/order/updateState",{
							data:person,
							dataType:'json',//服务器返回json格式数据
							type:'post',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
							headers:{'Content-Type':'application/json'},	              
							success:function(data){
								if(data.code ="0000"){
									mui.toast("恢复成功");
									setTimeout(function(){
									//mui.back();
									//window.location.href="manage.html";
								},500);	
								}
								
								
								
							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								console.log(type);
							}
						});
						
					})
					
					
					
					
					mui.get($server_path+"/homeApp/getOrderDetail",{id:ids},function(data){
	
							persons  = data.data;						
							$("#addressDetail").val(persons.detail);
							
							var str11 = '';
							//data.data.type = '30';
							if(data.data.type=="10"){
								
								str11 = '<button type="button" class="mui-btn mui-btn-success"  style="border-radius:0px ; height: 28px; line-height: 20px; padding: 0px; margin-top: 10px;" >派单中</button>';
								$("#cannelOrder").show();
								$("#hidderOrder").hide();
							}else if(data.data.type=="20"){
								str11 = '<button type="button" class="mui-btn mui-btn-success"  style="border-radius:0px ; height: 28px; line-height: 20px; padding: 0px; margin-top: 10px;" >已接单</button>';
								$("#cannelOrder").show();
								$("#hidderOrder").hide();
							}else if(data.data.type=="30"){
								str11 = '<button type="button" class="mui-btn mui-btn-danger"  style="border-radius:0px ; height: 28px; line-height: 20px; padding: 0px; margin-top: 10px;" >取消订单</button>';
								//alert($("#cannelOrder").val());
								$("#cannelOrder").show();
								$("#hidderOrder").hide();
							
							}else if(data.data.type=="40"){
								str11 = '<button type="button" class="mui-btn mui-btn-success"  style="border-radius:0px ; height: 28px; line-height: 20px; padding: 0px; margin-top: 10px;" >已完成</button>';
								$("#cannelOrder").hide();
								$("#hidderOrder").show();
								
								$(".showType").hide();
								$(".showType1").show();
								
								
							}else if(data.data.type=="60"){
								str11 = '<button type="button" class="mui-btn mui-btn-danger"  style="border-radius:0px ; height: 28px; line-height: 20px; padding: 0px; margin-top: 10px;" >取消订单</button>';
								//alert($("#cannelOrder").val());
								$("#cannelOrder").show();
								$("#hidderOrder").hide();
							
							}	
							
							$("#orderType").html(str11);
							
							$("#contactMobile").val(persons.contactName+persons.contactMobile);
							$("#cityResult3").val(data.data.city + " " +  data.data.country + " " +data.data.town);
							$("#lastTime").val(new Date(persons.doorTime).format("yyyy-MM-dd hh:mm:ss"));
							$("#weight").val(gettype(persons.weight));
							$("#buyPrice").val(data.data.buyprice);
							
							
							
							
							if(persons.weight =='20'){
								$("#weighttop").html("50");
								$("#weightbottom").html("20");
							}else if(persons.weight =='51'){
								$("#weighttop").html("51");
								$("#weightbottom").html("100");
							}else if(persons.weight =='101'){
								$("#weighttop").html("101");
								$("#weightbottom").html("500");
							}else if(persons.weight =='500'){
								$("#weighttop").html("500");
								$("#weightbottom").html("--");
							}
							
							mui.get($server_path+"/homeApp/goodsList",{},function(data){
								
								var str = "";
								if(persons.weight =='20'){
									$("#autoPrice").html("￥"+data.data[0].price*20+"-"+data.data[data.data.length-1].price*50);
								}else if(persons.weight =='51'){
									$("#autoPrice").html("￥"+data.data[0].price*51+"-"+data.data[data.data.length-1].price*100);
								}else if(persons.weight =='101'){
									$("#autoPrice").html("￥"+data.data[0].price*101+"-"+data.data[data.data.length-1].price*500);
								}else if(persons.weight =='500'){
									$("#autoPrice").html("￥"+data.data[0].price*500+"以上");
								}
								
								
								
								//获取价格区间
								//$("#autoPrice").html(data.data[0].price+"-"+data.data[data.data.length-1].price);  
								
								//获取商品列表
								//$("#goodsList").html(str);
								
								
								},'json'
							);
							
						
							
							
							
							
						},'json'
					);
					
				}else{
					
				
					
				}
			});
			
			
			
			mui('body').on('tap', '.mui-popover-action li>a', function() {
				var a = this,
					parent;
				//根据点击按钮，反推当前是哪个actionsheet
				for (parent = a.parentNode; parent != document.body; parent = parent.parentNode) {
					if (parent.classList.contains('mui-popover-action')) {
						break;
					}
				}
				//关闭actionsheet
				mui('#' + parent.id).popover('toggle');
				//alert(a.innerHTML);
				
				if(a.innerHTML=="<b>取消</b>"){
					
				}else{
					
					
					
					
				}
				
				
				
				//info.innerHTML = "你刚点击了\"" + a.innerHTML + "\"按钮";
			})
			
				
				
				
			
		</script>
	</body>

